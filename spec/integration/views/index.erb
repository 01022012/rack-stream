<html>
<head></head>
<body>
  <h1>Rack::Stream Sinatra Example</h1>
  <h2>Websocket</h2>
  <ul id='ws'></ul>

  <h2>EventSource</h2>
  <ul id='es'></ul>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script type='text/javascript'>
    var socket, source;

    function ws(m) {
      $('<li>').text(m).appendTo('#ws');
    }

    function es(m) {
      $('<li>').text(m).appendTo('#es');
    }

    $(function() {
      socket = new WebSocket("ws://localhost:8888/");
      socket.onopen    = function()  {ws('socket opened');}
      socket.onmessage = function(m) {ws(m.data);}
      socket.onclose   = function()  {ws('socket closed');}

      source = new EventSource('http://localhost:8888/');
      source.addEventListener('message', function(e) {
        es(e.data);
      });
    });
  </script>
</body>
</html>